---
layout: posts
title:  "D3.js ì°¨íŠ¸ ê°œë°œ Hands on lab"
categories: [D3.js]
tags: [Log Manage]
comments: true
toc: true


barchart:
  - url: /assets/images/posts/2022-11-11-D3-Chart/barchart.png
    image_path: /assets/images/posts/2022-11-11-D3-Chart/barchart.png
chart_layout:
  - url: /assets/images/posts/2022-11-11-D3-Chart/chart_layout.png
    image_path: /assets/images/posts/2022-11-11-D3-Chart/chart_layout.png
debug_console:
  - url: /assets/images/posts/2022-11-11-D3-Chart/debug_console.png
    image_path: /assets/images/posts/2022-11-11-D3-Chart/debug_console.png
interpolate:
  - url: /assets/images/posts/2022-11-11-D3-Chart/interpolate.png
    image_path: /assets/images/posts/2022-11-11-D3-Chart/interpolate.png
chart_sample:
  - url: /assets/images/posts/2022-11-11-D3-Chart/chart_sample1.png
    image_path: /assets/images/posts/2022-11-11-D3-Chart/chart_sample1.png
  - url: /assets/images/posts/2022-11-11-D3-Chart/chart_sample2.png
    image_path: /assets/images/posts/2022-11-11-D3-Chart/chart_sample2.png
---

ì§ë°© ê¸°ìˆ ì§€ì›íŒ€ ê¸°ìˆ ê³µìœ  ì„¸ë¯¸ë‚˜ ì¤‘ D3.jsë¥¼ ì†Œê°œí•œ ë‚´ìš©ì…ë‹ˆë‹¤

# Introduce

> D3 is not a monolithic framework that seeks to provide every conceivable feature. Instead, D3 solves the crux of the problem: **efficient manipulation of documents based on data** <br/><br/>D3ëŠ” ìƒê°í•  ìˆ˜ ìˆëŠ” ëª¨ë“  ê¸°ëŠ¥ì„ ì œê³µí•˜ë ¤ëŠ” ëª¨ë†€ë¦¬ì‹ í”„ë ˆì„ì›Œí¬ê°€ ì•„ë‹™ë‹ˆë‹¤. ëŒ€ì‹  D3ëŠ” ë¬¸ì œì˜ í•µì‹¬ì¸ **ë°ì´í„° ê¸°ë°˜ ë¬¸ì„œì˜ íš¨ìœ¨ì ì¸ ì¡°ì‘ì„ í•´ê²°í•©ë‹ˆë‹¤**.<br/><br/>- D3 ë¬¸ì„œ ì¤‘ì—ì„œ -

chart.js, billboard.js ë“±ì˜ ë°ì´í„°ì™€ ì˜µì…˜ì„ ì¡°ì ˆí•˜ì—¬ ê·¸ë˜í”„ë¥¼ ê·¸ë¦¬ëŠ” ë¼ì´ë¸ŒëŸ¬ë¦¬ì™€ ë‹¬ë¦¬ svg, canvasë¥¼ dataì™€ í•¨ê»˜ ë‹¤ë£¨ê¸° ì‰½ê²Œ ë„ì™€ì£¼ëŠ” ì €ìˆ˜ì¤€ ë¼ì´ë¸ŒëŸ¬ë¦¬.

<br/>

# ì™œ ì“¸ê¹Œ? ì°¨íŠ¸ ë¼ì´ë¸ŒëŸ¬ë¦¬ vs ì§ì ‘ ê°œë°œ(d3)

- billboard.js (d3 base)ë¥¼ ì‚¬ìš©í•  ê²½ìš°
    
    ```jsx
    <!-- Markup -->
    <div id="lineChart"></div>
    
    <!-- JS -->
    var chart = bb.generate({
      data: {
        columns: [
    			["data1", 30, 200, 100, 400, 150, 250],
        ],
        type: "line",
      },
      bindto: "#lineChart"
    });
    ```
    
- d3.js ë¥¼ ì‚¬ìš©í•  ê²½ìš°
    
    ```jsx
    function LineChart(data, {
      x = ([x]) => x, // given d in data, returns the (temporal) x-value
      y = ([, y]) => y, // given d in data, returns the (quantitative) y-value
      defined, // for gaps in data
      curve = d3.curveLinear, // method of interpolation between points
      marginTop = 20, // top margin, in pixels
      marginRight = 30, // right margin, in pixels
      marginBottom = 30, // bottom margin, in pixels
      marginLeft = 40, // left margin, in pixels
      width = 640, // outer width, in pixels
      height = 400, // outer height, in pixels
      xType = d3.scaleUtc, // the x-scale type
      xDomain, // [xmin, xmax]
      xRange = [marginLeft, width - marginRight], // [left, right]
      yType = d3.scaleLinear, // the y-scale type
      yDomain, // [ymin, ymax]
      yRange = [height - marginBottom, marginTop], // [bottom, top]
      yFormat, // a format specifier string for the y-axis
      yLabel, // a label for the y-axis
      color = "currentColor", // stroke color of line
      strokeLinecap = "round", // stroke line cap of the line
      strokeLinejoin = "round", // stroke line join of the line
      strokeWidth = 1.5, // stroke width of line, in pixels
      strokeOpacity = 1, // stroke opacity of line
    } = {}) {
      // Compute values.
      const X = d3.map(data, x);
      const Y = d3.map(data, y);
      const I = d3.range(X.length);
      if (defined === undefined) defined = (d, i) => !isNaN(X[i]) && !isNaN(Y[i]);
      const D = d3.map(data, defined);
    
      // Compute default domains.
      if (xDomain === undefined) xDomain = d3.extent(X);
      if (yDomain === undefined) yDomain = [0, d3.max(Y)];
    
      // Construct scales and axes.
      const xScale = xType(xDomain, xRange);
      const yScale = yType(yDomain, yRange);
      const xAxis = d3.axisBottom(xScale).ticks(width / 80).tickSizeOuter(0);
      const yAxis = d3.axisLeft(yScale).ticks(height / 40, yFormat);
    
      // Construct a line generator.
      const line = d3.line()
          .defined(i => D[i])
          .curve(curve)
          .x(i => xScale(X[i]))
          .y(i => yScale(Y[i]));
    
      const svg = d3.create("svg")
          .attr("width", width)
          .attr("height", height)
          .attr("viewBox", [0, 0, width, height])
          .attr("style", "max-width: 100%; height: auto; height: intrinsic;");
    
      svg.append("g")
          .attr("transform", `translate(0,${height - marginBottom})`)
          .call(xAxis);
    
      svg.append("g")
          .attr("transform", `translate(${marginLeft},0)`)
          .call(yAxis)
          .call(g => g.select(".domain").remove())
          .call(g => g.selectAll(".tick line").clone()
              .attr("x2", width - marginLeft - marginRight)
              .attr("stroke-opacity", 0.1))
          .call(g => g.append("text")
              .attr("x", -marginLeft)
              .attr("y", 10)
              .attr("fill", "currentColor")
              .attr("text-anchor", "start")
              .text(yLabel));
    
      svg.append("path")
          .attr("fill", "none")
          .attr("stroke", color)
          .attr("stroke-width", strokeWidth)
          .attr("stroke-linecap", strokeLinecap)
          .attr("stroke-linejoin", strokeLinejoin)
          .attr("stroke-opacity", strokeOpacity)
          .attr("d", line(I));
    
      return svg.node();
    }
    ```
    

ìƒì‚°ì„±ì´ ì¤‘ìš”. ìœ ì§€ë³´ìˆ˜ ë¹„ìš© ì¤„ì—¬ì•¼ í•œë‹¤ â†’ ì°¨íŠ¸ ë¼ì´ë¸ŒëŸ¬ë¦¬

ë°ì´í„°ë¥¼ ì°¨ë³„í™”í•´ì„œ ë³´ì—¬ì¤˜ì•¼í•œë‹¤. (ì»¤ìŠ¤í…€ì´ ì¤‘ìš”) â†’ d3ë¡œ ì§ì ‘ ë§Œë“¤ì–´ì•¼ í•¨.

<br/>

# ë§Œë“¤ë©° ì½”ë“œ ë“¤ì—¬ë‹¤ë³´ê¸°

[ìƒ˜í”Œ codepen ë§í¬](https://codepen.io/Seunghyum/pen/qBKrdWE)

ì´ ë°ì´í„°ë¡œ

```jsx
const data = [
  {name: "ğŸŠ", count: 21},
  {name: "ğŸ‡", count: 13},
  {name: "ğŸ", count: 8},
  {name: "ğŸŒ", count: 5},
  {name: "ğŸ", count: 3},
  {name: "ğŸ‹", count: 2},
  {name: "ğŸ", count: 1},
  {name: "ğŸ‰", count: 1}
]
```

bar ì°¨íŠ¸ë¥¼ ë§Œë“¤ì–´ ë³´ì

{% include gallery id="barchart"%}

## 1. Element Select

d3ì˜ selection ë¬¸ë²•ì€ jquery ë¬¸ë²•ê³¼ ë¹„ìŠ·. ê°€ì¥ ê¸°ë³¸ì´ ë˜ëŠ” svg íƒœê·¸ë¥¼ ì¶”ê°€.

```jsx
<!-- HTML -->
<div id="chart"></div>

<!-- JS -->
const svg = d3
  .select('#chart')
  .append('svg')
  .attr('viewBox', `0 0 ${width + (margin.left + margin.right)} ${height + (margin.top + margin.bottom)}`)
  .attr('width', width)
  .attr('height', height);
```

g íƒœê·¸ëŠ” ì£¼ë¡œ transform ìœ¼ë¡œ children elementsë¥¼ ê·¸ë£¹í•‘í•˜ì—¬ í•œêº¼ë²ˆì— ì‚¬ìš©í•  ë•Œ ë§ì´ì”€. (transform ì†ì„±)

```jsx
const group = svg
  .append('g')
  .attr('transform', `translate(${margin.left} ${margin.top})`);
```

{% include gallery id="chart_layout"%}

xì¶•, yì¶• ì„ viewBox ì•ˆìœ¼ë¡œ ë°€ì–´ ë„£ê¸° ìœ„í•´ margin ê°’ ì„¤ì •

## 2. Scale ì„¤ì • (xì¶•, yì¶•)

- scale : ì¶”ìƒì  ì°¨ì›(abstract dimension) ì„¤ì •
    - d3.scaleBand : ì¹´í…Œê³ ë¦¬í˜• (name : `ğŸŠ, ğŸ‡, ğŸ, ğŸŒ, ğŸ, ğŸ‹, ğŸ, ğŸ‰`)
        
        ```jsx
        const yScale = d3
          .scaleBand()
          .domain(data.map(({ name }) => name)) // ğŸŠ, ğŸ‡, ğŸ, ğŸŒ, ğŸ, ğŸ‹, ğŸ, ğŸ‰
          .range([0, height])
          .padding(0.2);
        
        const yAxis = d3
          .axisLeft(yScale); // d3ê°€ ì œê³µí•˜ëŠ” ì‰½ê²Œ ì¶•ì„ ê·¸ë ¤ì£¼ëŠ” í•¨ìˆ˜
        
        // ì˜ˆì‹œ
        yScale(ğŸŠ) :  12.439024390243873
        yScale(ğŸ‡) :  74.63414634146339
        yScale(ğŸ) :  136.8292682926829
        yScale(ğŸŒ) :  199.02439024390245
        yScale(ğŸ) :  261.219512195122
        yScale(ğŸ‹) :  323.4146341463414
        yScale(ğŸ) :  385.609756097561
        yScale(ğŸ‰) :  447.80487804878055
        ```
        
    - d3.scaleLinear : ì„ í˜• (count : `21, 13, 8, 5, 3, 2, 1, 1`)
        
        ```jsx
        const xScale = d3
          .scaleLinear()
          .domain([0, d3.max(data, ({ count }) => count)]) // 21, 13, 8, 5, 3, 2, 1, 1
          .range([0, width]);
        
        const xAxis = d3
          .axisBottom(xScale); // d3ê°€ ì œê³µí•˜ëŠ” ì‰½ê²Œ ì¶•ì„ ê·¸ë ¤ì£¼ëŠ” í•¨ìˆ˜
        
        // ì˜ˆì‹œ
        xScale(21) :  680
        xScale(13) :  420.95238095238096
        xScale(8) :  259.04761904761904
        xScale(5) :  161.9047619047619
        xScale(3) :  97.14285714285714
        xScale(2) :  64.76190476190476
        xScale(1) :  32.38095238095238
        ```
        
- domain : ê°’ì˜ ë²”ìœ„(min/max)
- range : domain ì•ˆì—ì„œ ê°’(value)ì´ ì°¨íŠ¸ì—ì„œ ì‹¤ì œ ìœ„ì¹˜í•´ì•¼í•  ìœ„ì¹˜ ì˜ì—­ ì„¤ì •(position encoding)

## 3. ë°ì´í„° ë°”ì¸ë”©

```jsx
const groups = group
  .selectAll('g.group') // group í´ë˜ìŠ¤ë¥¼ ê°€ì§„ g íƒœê·¸ë“¤ì„ ì „ë¶€ ì„ íƒ.
  .data(data) // data ë§¤ì„œë“œë¡œ selection ê°ì²´ì— ë°ì´í„°ë¥¼ ë°”ì¸ë”©.
  .enter() // ë§Œì•½ g.group ì—˜ë¦¬ë¨¼íŠ¸ê°€ ì—†ì„ ê²½ìš° ìƒˆë¡œìš´ g.groupì„ ë°˜í™˜í•˜ë„ë¡ ì„¤ì •.
  .append('g') // ì—†ëŠ” ì—˜ë¦¬ë¨¼íŠ¸ë¥¼ ì±„ì›Œ ë„£ìŒ.
  .attr('class', 'group')
  .attr('transform', ({ name }) => `translate(0 ${yScale(name)})`) // dataë¡œ ë§µí•‘í•œ ìš”ì†Œë“¤ì„ iterating í•˜ë©° ê°’ì„ ì„¤ì •.

groups
  .append('rect')
  .attr('x', 0)
  .attr('y', 0)
  .attr('width', ({ count }) => xScale(count))
  .attr('height', yScale.bandwidth())
  .style('fill', '#6994C0');
```

d3ëŠ” ì¡´ì¬í•˜ì§€ ì•ŠëŠ” ìš”ì†Œë“¤ì„ ì„ íƒ(.selectAll())í•˜ê³  ë°”ì¸ë“œ(.data(), .enter())í•˜ëŠ” ê²½ìš°ê°€ ë§ìŒ.

ì´ëŠ” ë°ì´í„°ë¥¼ ê¸°ë°˜ìœ¼ë¡œ ì—˜ë¦¬ë¨¼íŠ¸ë¥¼ ë™ì ìœ¼ë¡œ ë§Œë“¤ê¸° ë•Œë¬¸ì— ê°€ìƒìœ¼ë¡œ selection ê°ì²´ë¥¼ ë§Œë“¤ê³  ê·¸ ê°ì²´ë¡œ dom ìš”ì†Œë¥¼ ì¡°ì‘(ìƒì„±/ìˆ˜ì •/ì‚­ì œ)í•˜ê¸° ë•Œë¬¸.

{% include gallery id="debug_console"%}


ğŸ‘‰ selection ê°ì²´ ë™ì‘ì„ ì˜ ì„¤ëª…í•´ì£¼ëŠ” [ë¸”ë¡œê·¸ ë§í¬](https://www.44bits.io/ko/post/d3js-basic-understanding-select-and-enter-api#data%EC%99%80-enter-%ED%99%94%EB%A9%B4%EC%97%90-%EC%97%86%EB%8A%94-%EB%8D%B0%EC%9D%B4%ED%84%B0%EB%A5%BC-%EB%B3%B4%EC%97%AC%EC%A4%84-%EC%A4%80%EB%B9%84%ED%95%98%EA%B8%B0)


## 4. ê·¸ ì™¸ì˜ ìœ ìš©í•œ ê²ƒë“¤

- ë³´ê°„(interpolate)ì´ë¼ëŠ” ê°œë…ì„ ì‚¬ìš©í•´ì„œ ìƒ‰ê¹”ë¡œ ê°’ì˜ í¬ê¸°ë¥¼ ê°€ëŠ í•˜ê²Œë„ ë§Œë“¤ ìˆ˜ ìˆìŒ. (d3.interpolator, color scheme)

{% include gallery id="interpolate"%}

- ë°ì´í„°ì˜ í†µê³„ ê°’ ë“±ì„ ì¶”ì¶œí•´ë‚¼ ë•Œ ìœ ìš©í•œ ì—°ì‚° ë§¤ì„œë“œë“¤ì„ ì œê³µ
    
    ```jsx
    d3.extent([3, 2, 1, 1, 6, 2, 4])
    // [1, 6]
    ```
    
- ì´ ë°–ì—ë„ ì§€ë„ ë°ì´í„°ë¥¼ í‘œí˜„í•˜ê¸° ìœ„í•œ polygon ë°ì´í„°ë“¤ë„ ë‹¤ë£¨ê¸° í¸í•˜ê²Œ ì œê³µí•˜ëŠ” í•¨ìˆ˜ë“¤ë„ ë§ìŒ. d3-geo, d3-geo-projection, d3-polygon

<br/>

# ì§ë°© ì‹œì„¸ ì°¨íŠ¸

{% include gallery id="chart_sample"%}

í˜¸ê°±ë…¸ë…¸ì˜ d3 ì°¨íŠ¸ë¥¼ ì§ë°©ìœ¼ë¡œ ê°€ì ¸ì˜¤ëŠ” ì‘ì—….

í•œ ì°¨íŠ¸ ì•ˆì— í•„í„°ì— ë”°ë¼ ì—¬ëŸ¬ ì°¨íŠ¸ë“¤ê³¼ ì¶”ê°€ì  ìš”ì†Œë“¤(ì¸í„°ë ‰í‹°ë¸Œ íˆ´íŒ ë“±)ì„ ì¡°í•©í•´ì„œ í‘œí˜„í•´ì•¼ í–ˆìŒ.

![chart_category1.png](/assets/images/posts/2022-11-11-D3-Chart/chart_category1.png)
![chart_category2.png](/assets/images/posts/2022-11-11-D3-Chart/chart_category2.png)
![chart_category3.png](/assets/images/posts/2022-11-11-D3-Chart/chart_category3.png)
![chart_category4.png](/assets/images/posts/2022-11-11-D3-Chart/chart_category4.png)

d3 ì“°ë©´ì„œ ëŠë‚€ì : 

- ì»¤ìŠ¤í…€ì€ a-z ë‹¤ ê°€ëŠ¥.
- d3ê°€ ì œê³µí•˜ëŠ” ìœ í‹¸ë“¤ì´ ì •ë§ ìœ ìš©í•˜ë‹¤.

<br/>

# ê³µë¶€í•˜ê¸° ì¢‹ì€ ì‚¬ì´íŠ¸

d3 ê°œë°œì Mike BostockëŠ” ë‹¤ì–‘í•œ ì˜ˆì‹œë“¤ì˜ ì½”ë“œë¥¼ ë³´ë©° ê°ì„ ì¡ê³  ë¬¸ì„œë¥¼ ì°¾ì•„ë³´ëŠ” ë°©ì‹ì˜ ê³µë¶€ë¥¼ ì¶”ì²œ

- ë‹¤ì–‘í•œ ì˜ˆì‹œ - [https://d3-graph-gallery.com/](https://d3-graph-gallery.com/)
- ì¢‹ì€ íŠœí† ë¦¬ì–¼ - [https://observablehq.com/collection/@d3/learn-d3](https://observablehq.com/collection/@d3/learn-d3)
- daveê°€ ë§Œë“  [ìƒ˜í”Œ codepen ë§í¬](https://codepen.io/Seunghyum/pen/qBKrdWE)

<br/>

# ì¶”ê°€ì ì¸ ì§ˆë¬¸

## webgl??

- openGL ES 2.0ì„ ê¸°ë°˜ìœ¼ë¡œ ë¸Œë¼ìš°ì € canvas ì— ë Œë”ë§í•˜ì—¬ 3D ì›¹ ì½˜í…ì¸  ì œì‘
- ëŒ€í‘œì ìœ¼ë¡œ [three.js](https://threejs.org/)

## canvas vs svg

- canvas
    - ê³ ì† ì• ë‹ˆë©”ì´ì…˜ì´ í•„ìš”í•œ ê²½ìš° ì í•©. ê·¸ë˜í”½ í•˜ë“œì›¨ì–´ë¥¼ ì‚¬ìš©í•˜ê¸° ë•Œë¬¸ì´ë¼ê³  í•¨.
    - domìœ¼ë¡œ ë³´ë©´ canvas íƒœê·¸ í•˜ë‚˜ë§Œ ìˆìŒ. ì¸í„°ë ‰í‹°ë¸Œí•œ ê²ƒì„ êµ¬í˜„í•˜ë ¤ë©´ ì¢Œí‘œê°’ ê¸°ë°˜ìœ¼ë¡œ canvas ê°ì²´ë“¤ì˜ ìœ„ì¹˜ë¥¼ ë¹„êµí•´ê°€ë©° ë§Œë“¤ì–´ì•¼ í•¨.
- svg
    - ì—˜ë¦¬ë¨¼íŠ¸ ì¸í„°ë ‰í‹°ë¸Œí•œ í‘œí˜„ì„ êµ¬í˜„í•˜ê¸° ì‰¬ì›€. svg íƒœê·¸ ì•ˆì— rect, circle, path ë“±ì˜ ì—¬ëŸ¬ ìš”ì†Œë“¤ì´ ë‚˜ë‰˜ì–´ì ¸ ìˆìŒ.